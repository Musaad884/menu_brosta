<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ŸÖÿ∑ÿπŸÖ ÿ®ÿ±Ÿàÿ≥ÿ™ÿß</title>
  <!-- ÿ≥ŸÉÿ±ÿ®ÿ™ ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ ŸàŸäÿ®-ÿ£ÿ® (ŸÑÿßÿ≤ŸÖ) -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: Tahoma, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 0;
      color: #333;
    }
    header {
      background: #fff;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
      font-weight: bold;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: relative;
    }
    .checkout-global {
      position: sticky;
      top: 0;
      z-index: 10;
      background: #f9f9f9;
      text-align: center;
      padding: 0.5rem;
    }
    .checkout-global button {
      background: #4CAF50;
      color: #fff;
      padding: 0.8rem 1.2rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }
    .menu {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1rem;
      padding: 1rem;
    }
    .item {
      background: #fff;
      border-radius: 12px;
      padding: 1rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 12px;
      margin-bottom: 0.5rem;
    }
    .item h3 {
      font-size: 1.1rem;
      margin: 0.5rem 0;
    }
    .item p {
      font-size: 0.9rem;
      margin: 0.3rem 0;
    }
    .item .actions {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }
    .item button {
      padding: 0.6rem 0.8rem;
      background: #4CAF50;
      color: #fff;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
    }
    .item .qty-btn {
      background: #2196F3;
      padding: 0.4rem 0.7rem;
      font-size: 1.2rem;
      font-weight: bold;
    }
    .cart {
      position: fixed;
      top: 0;
      right: -400px;
      width: 350px;
      height: 100%;
      background: #fff;
      box-shadow: -2px 0 6px rgba(0,0,0,0.2);
      padding: 1rem;
      transition: right 0.3s ease;
      display: flex;
      flex-direction: column;
    }
    .cart.open {
      right: 0;
    }
    .cart h2 {
      margin-top: 0;
    }
    .cart-items {
      flex: 1;
      overflow-y: auto;
    }
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .cart-item button {
      background: #f44336;
      border: none;
      color: #fff;
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      cursor: pointer;
    }
    .cart-toggle {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #2196F3;
      color: #fff;
      padding: 1rem;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
  </style>
</head>
<body>
  <header>ŸÖŸÜŸäŸà ŸÖÿ∑ÿπŸÖ ÿ®ÿ±Ÿàÿ≥ÿ™ÿß</header>
  
  <!-- ÿ≤ÿ± ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ™ÿ≠ÿ™ ÿßŸÑŸáŸäÿØÿ± -->
  <div class="checkout-global">
    <button onclick="checkout()">ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ®</button>
  </div>

  <div class="menu" id="menu"></div>
  <div class="cart" id="cart">
    <h2>ÿßŸÑÿ≥ŸÑÿ©</h2>
    <div class="cart-items" id="cart-items"></div>
  </div>
  <div class="cart-toggle" onclick="toggleCart()">üõí</div>

  <script>
    // ÿ™ŸáŸäÿ¶ÿ© ÿ®ÿ≥Ÿäÿ∑ÿ© ŸÑŸàŸäÿ®-ÿ£ÿ® ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ
    const tg = (window.Telegram && window.Telegram.WebApp) ? window.Telegram.WebApp : null;
    if (tg) { try { tg.ready(); tg.expand(); } catch(_){} }

    const menuData = [
      {id:1, category:'Sandwiches / ÿßŸÑÿ≥ŸÜÿØŸàÿ™ÿ¥ÿßÿ™', name:'Smoked Chicken Burger / ÿ®ÿ±ÿ¨ÿ± ŸÖÿØÿÆŸÜ ÿØÿ¨ÿßÿ¨', description:'Crispy chicken burger with lettuce & sauce / ÿ®ÿ±ÿ¨ÿ± ÿØÿ¨ÿßÿ¨ ŸÉÿ±ÿ≥ÿ®Ÿä ŸÖÿπ ÿßŸÑÿÆÿ≥ ŸàÿßŸÑÿµŸàÿµ', price:'17-25', image:'2.tcbdyinamic.jpg'},
      {id:2, category:'Sandwiches / ÿßŸÑÿ≥ŸÜÿØŸàÿ™ÿ¥ÿßÿ™', name:'Smoked Chicken Burger Spicy / ÿ®ÿ±ÿ¨ÿ± ŸÖÿØÿÆŸÜ ÿØÿ¨ÿßÿ¨ ÿ≠ÿßÿ±', description:'Crispy spicy chicken burger with lettuce & sauce / ÿ®ÿ±ÿ¨ÿ± ÿØÿ¨ÿßÿ¨ ŸÉÿ±ÿ≥ÿ®Ÿä ÿ≠ÿßÿ± ŸÖÿπ ÿßŸÑÿÆÿ≥ ŸàÿßŸÑÿµŸàÿµ', price:'17-25', image:'tcbbbq.jpg'},
      {id:3, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'Smoked Broasted / ÿ®ÿ±Ÿàÿ≥ÿ™ÿØ ŸÖÿØÿÆŸÜ', description:'4 pcs smoked broasted chicken with fries & sauce / Ÿ§ ŸÇÿ∑ÿπ ÿØÿ¨ÿßÿ¨ ÿ®ÿ±Ÿàÿ≥ÿ™ÿØ ŸÖÿØÿÆŸÜ ŸÖÿπ ÿßŸÑÿ®ÿ∑ÿßÿ∑ÿ≥ ŸàÿßŸÑÿµŸàÿµ', price:'29', image:'tcbdynamicchess.jpg'},
      {id:4, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'Spicy Smoked Broasted / ÿ®ÿ±Ÿàÿ≥ÿ™ÿØ ŸÖÿØÿÆŸÜ ÿ≠ÿßÿ±', description:'4 pcs spicy smoked broasted chicken with fries & sauce / Ÿ§ ŸÇÿ∑ÿπ ÿØÿ¨ÿßÿ¨ ÿ®ÿ±Ÿàÿ≥ÿ™ÿØ ŸÖÿØÿÆŸÜ ÿ≠ÿßÿ± ŸÖÿπ ÿßŸÑÿ®ÿ∑ÿßÿ∑ÿ≥ ŸàÿßŸÑÿµŸàÿµ', price:'29', image:'tcbfrench.jpg'},
      {id:5, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'Smoked Crispy / ŸÉÿ±Ÿäÿ≥ÿ®Ÿä ŸÖÿØÿÆŸÜ', description:'Smoked crispy chicken with fries & sauce / ÿØÿ¨ÿßÿ¨ ŸÉÿ±Ÿäÿ≥ÿ®Ÿä ŸÖÿØÿÆŸÜ ŸÖÿπ ÿßŸÑÿ®ÿ∑ÿßÿ∑ÿ≥ ŸàÿßŸÑÿµŸàÿµ', price:'25', image:'2.tcbdyinamic.jpg'},
      {id:6, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'Spicy Smoked Crispy / ŸÉÿ±Ÿäÿ≥ÿ®Ÿä ŸÖÿØÿÆŸÜ ÿ≠ÿßÿ±', description:'Spicy smoked crispy chicken with fries & sauce / ÿØÿ¨ÿßÿ¨ ŸÉÿ±Ÿäÿ≥ÿ®Ÿä ŸÖÿØÿÆŸÜ ÿ≠ÿßÿ± ŸÖÿπ ÿßŸÑÿ®ÿ∑ÿßÿ∑ÿ≥ ŸàÿßŸÑÿµŸàÿµ', price:'26', image:'2.tcbdyinamic.jpg'},
      {id:7, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'Smoked Crunchy / ŸÉÿ±ÿßŸÜÿ¥Ÿä ŸÖÿØÿÆŸÜ', description:'Smoked crunchy chicken with fries & sauce / ÿµÿØŸàÿ± ÿØÿ¨ÿßÿ¨ ŸÖÿØÿÆŸÜÿ© ŸÖÿπ ÿßŸÑÿ®ÿ∑ÿßÿ∑ÿ≥ ŸàÿßŸÑÿµŸàÿµ', price:'32', image:'2.tcbdyinamic.jpg'},
      {id:8, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'Smoked Crunchy Spicy / ŸÉÿ±ÿßŸÜÿ¥Ÿä ŸÖÿØÿÆŸÜ ÿ≠ÿßÿ±', description:'Spicy smoked crunchy chicken with fries & sauce / ÿµÿØŸàÿ± ÿØÿ¨ÿßÿ¨ ŸÖÿØÿÆŸÜÿ© ÿ≠ÿßÿ±ÿ© ŸÖÿπ ÿßŸÑÿ®ÿ∑ÿßÿ∑ÿ≥ ŸàÿßŸÑÿµŸàÿµ', price:'31', image:'2.tcbdyinamic.jpg'},
      {id:9, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'Cheese Fries / ÿ®ÿ∑ÿßÿ∑ÿ≥ ÿ®ÿßŸÑÿ¨ÿ®ŸÜÿ©', description:'Fries topped with cheese / ÿ®ÿ∑ÿßÿ∑ÿ≥ ŸÖÿπ ÿ¨ÿ®ŸÜÿ©', price:'14', image:'2.tcbdyinamic.jpg'},
      {id:10, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'Smoked Chicken Fries / ÿ≥ŸÖŸàŸÉÿØ ÿ™ÿ¥ŸÉŸÜ ŸÅÿ±ÿßŸäÿ≤', description:'Fries topped with smoked chicken / ÿ®ÿ∑ÿßÿ∑ÿ≥ ŸÖÿπ ÿØÿ¨ÿßÿ¨ ŸÖÿØÿÆŸÜ', price:'25', image:'2.tcbdyinamic.jpg'},
      {id:11, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'Onion Rings / ÿ≠ŸÑŸÇÿßÿ™ ÿßŸÑÿ®ÿµŸÑ', description:'Fried onion rings / ÿ≠ŸÑŸÇÿßÿ™ ÿ®ÿµŸÑ ŸÖŸÇŸÑŸäÿ©', price:'9', image:'2.tcbdyinamic.jpg'},
      {id:12, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'French Fries / ÿ®ÿ∑ÿßÿ∑ÿ≥ ŸÖŸÇŸÑŸäÿ©', description:'Regular fries / ÿ®ÿ∑ÿßÿ∑ÿ≥ ÿπÿßÿØŸäÿ©', price:'8', image:'2.tcbdyinamic.jpg'},
      {id:13, category:'Meals / ÿßŸÑŸàÿ¨ÿ®ÿßÿ™', name:'Curly Fries / ŸÉŸäÿ±ŸÑŸä ŸÅÿ±ÿßŸäÿ≤', description:'Curly fries / ÿ®ÿ∑ÿßÿ∑ÿ≥ ÿ≠ŸÑÿ≤ŸàŸÜŸäÿ©', price:'9', image:'2.tcbdyinamic.jpg'},
      {id:14, category:'Sauces / ÿßŸÑÿµŸàÿµÿßÿ™', name:'Spicy Sauce / ÿµŸàÿµ ÿ≠ÿßÿ±', description:'Spicy sauce / ÿµŸàÿµ ÿ≠ÿßÿ±', price:'1', image:'2.tcbdyinamic.jpg'},
      {id:15, category:'Sauces / ÿßŸÑÿµŸàÿµÿßÿ™', name:'Garlic Sauce / ÿµŸàÿµ ÿ´ŸàŸÖ', description:'Garlic Sauce / ÿµŸàÿµ ÿ´ŸàŸÖ', price:'1', image:'2.tcbdyinamic.jpg'},
      {id:16, category:'Sauces / ÿßŸÑÿµŸàÿµÿßÿ™', name:'Cheese Sauce / ÿµŸàÿµ ÿ¨ÿ®ŸÜÿ©', description:'Cheese Sauce / ÿµŸàÿµ ÿ¨ÿ®ŸÜÿ©', price:'3', image:'2.tcbdyinamic.jpg'},
      {id:17, category:'Drinks / ŸÖÿ¥ÿ±Ÿàÿ®ÿßÿ™', name:'Fanta / ŸÅÿßŸÜÿ™ÿß', description:'Soft drink / ŸÖÿ¥ÿ±Ÿàÿ® ÿ∫ÿßÿ≤Ÿä', price:'4', image:'2.tcbdyinamic.jpg'},
      {id:18, category:'Drinks / ŸÖÿ¥ÿ±Ÿàÿ®ÿßÿ™', name:'Sprite / ÿ≥ÿ®ÿ±ÿßŸäÿ™', description:'Soft drink / ŸÖÿ¥ÿ±Ÿàÿ® ÿ∫ÿßÿ≤Ÿä', price:'4', image:'2.tcbdyinamic.jpg'},
      {id:19, category:'Drinks / ŸÖÿ¥ÿ±Ÿàÿ®ÿßÿ™', name:'Cola / ŸÉŸàŸÑÿß', description:'Soft drink / ŸÖÿ¥ÿ±Ÿàÿ® ÿ∫ÿßÿ≤Ÿä', price:'4', image:'2.tcbdyinamic.jpg'}
    ];

    const menuContainer = document.getElementById("menu");
    const cartContainer = document.getElementById("cart-items");
    let cart = [];
    let checkoutStep = 0; // ŸÑŸÑÿ™ÿ≠ŸÉŸÖ ÿ®ÿÆÿ∑Ÿàÿßÿ™ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ

    function renderMenu(){
      menuContainer.innerHTML = "";
      menuData.forEach(item => {
        const div = document.createElement("div");
        div.className = "item";
        const inCart = cart.find(c => c.id === item.id);

        div.innerHTML = `
          <img src="${item.image || 'https://via.placeholder.com/300x150'}" alt="${item.name}" />
          <h3>${item.name}</h3>
          <p>${item.description}</p>
          <p><strong>${item.price} ÿ±ŸäÿßŸÑ</strong></p>
          <div class="actions" id="actions-${item.id}">
            ${inCart 
              ? `
                <button class="qty-btn" onclick="changeQty(${item.id}, -1)">-</button>
                <span>${inCart.qty}</span>
                <button class="qty-btn" onclick="changeQty(${item.id}, 1)">+</button>
              `
              : `<button onclick="addToCart(${item.id})">ÿßÿ∂ŸÅ ŸÑŸÑÿ≥ŸÑÿ©</button>`
            }
          </div>
        `;
        menuContainer.appendChild(div);
      });
    }

    function addToCart(id){
      const item = menuData.find(m => m.id === id);
      const found = cart.find(c => c.id === id);
      if(found){
        found.qty++;
      } else {
        cart.push({...item, qty:1});
      }
      renderMenu();
      renderCart();
    }

    function changeQty(id, delta){
      const found = cart.find(c => c.id === id);
      if(found){
        found.qty += delta;
        if(found.qty <= 0){
          cart = cart.filter(c => c.id !== id);
        }
      }
      renderMenu();
      renderCart();
    }

    function removeFromCart(id){
      cart = cart.filter(c => c.id !== id);
      renderMenu();
      renderCart();
    }

    function renderCart(){
      cartContainer.innerHTML = '';
      cart.forEach(c => {
        const div = document.createElement("div");
        div.className = "cart-item";
        div.innerHTML = `
          <span>${c.name} x${c.qty}</span>
          <button onclick="removeFromCart(${c.id})">ÿ≠ÿ∞ŸÅ</button>
        `;
        cartContainer.appendChild(div);
      });

      // ÿßŸÑÿ≥ÿπÿ± ÿßŸÑŸÜŸáÿßÿ¶Ÿä
      const total = cart.reduce((sum,c) => sum + (parseFloat(c.price) || 0) * c.qty, 0);
      const totalDiv = document.createElement("div");
      totalDiv.style.marginTop = "1rem";
      totalDiv.style.fontWeight = "bold";
      totalDiv.innerText = "ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸä: " + total + " ÿ±ŸäÿßŸÑ";
      cartContainer.appendChild(totalDiv);
    }

    function toggleCart(){
      document.getElementById("cart").classList.toggle("open");
    }

    /* ==== ÿ•ÿ∂ÿßŸÅÿßÿ™ ŸÑÿ∂ŸÖÿßŸÜ ŸàÿµŸàŸÑ chat_id ŸàŸÇŸäŸÖ ÿ±ŸÇŸÖŸäÿ© ÿµÿ≠Ÿäÿ≠ÿ© ==== */
    function getChatId() {
      const fromTG = window.Telegram?.WebApp?.initDataUnsafe?.user?.id ?? null;
      if (fromTG) return Number(fromTG);
      const params = new URLSearchParams(location.search);
      const fromURL = params.get('chat_id');
      return fromURL ? Number(fromURL) : null;
    }

    function sanitizeCartItems(items) {
      return items.map(i => {
        const priceNum = parseFloat(String(i.price).toString().split('-')[0]) || 0; // ŸäÿØÿπŸÖ "17-25"
        const qtyNum = Number(i.qty || 0);
        return { id: i.id, name: i.name, price: priceNum, qty: qtyNum };
      });
    }
    /* ===================================================== */

    // ===== ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿπÿ®ÿ± Webhook ÿ•ŸÑŸâ n8n ŸÖÿπ ÿ™ŸÖÿ±Ÿäÿ± chat_id =====
    async function checkout(){
      if(cart.length === 0){
        alert("ÿßŸÑÿ≥ŸÑÿ© ŸÅÿßÿ±ÿ∫ÿ©!");
        return;
      }

      // ÿ£ŸàŸÑ ÿ∂ÿ∫ÿ∑ÿ©: ÿßŸÅÿ™ÿ≠ ÿßŸÑÿ≥ŸÑÿ© ŸÑŸÑÿπŸÖŸäŸÑ
      if(checkoutStep === 0){
        toggleCart();
        checkoutStep = 1;
        return;
      }

      // ÿ™ÿ£ŸÉÿØ ÿ£ŸÜŸÜÿß ÿØÿßÿÆŸÑ ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ
      if(!window.Telegram?.WebApp){
        alert("‚ö†Ô∏è ÿßŸÅÿ™ÿ≠ ÿßŸÑŸÖŸÜŸäŸà ŸÖŸÜ ÿØÿßÿÆŸÑ ÿ™ŸäŸÑŸäÿ¨ÿ±ÿßŸÖ ÿπÿ®ÿ± ÿ≤ÿ± ÿßŸÑÿ®Ÿàÿ™.");
        return;
      }

      const chat_id = getChatId(); // ÿ£ŸáŸÖ ÿ¥Ÿäÿ°
      const cleanItems = sanitizeCartItems(cart);
      const total = cleanItems.reduce((s,c) => s + (c.price * c.qty), 0);

      const payload = {
        items: cleanItems,
        total,
        time: new Date().toISOString(),
        chat_id,
        source: "webapp"
      };

      try {
        const res = await fetch("https://s9188.app.n8n.cloud/webhook/cart_submit", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(payload)
        });

        if(res.ok){
          alert("ÿ™ŸÖ ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿ∑ŸÑÿ® ÿ®ŸÜÿ¨ÿßÿ≠! ‚úÖ");
          try { window.Telegram.WebApp.close(); } catch(_) {}
          cart = [];
          renderMenu();
          renderCart();
          checkoutStep = 0;
        } else {
          const t = await res.text();
          alert("‚ö†Ô∏è ŸÅÿ¥ŸÑ ÿßŸÑÿ•ÿ±ÿ≥ÿßŸÑ\n" + t);
        }
      } catch (err) {
        alert("‚ùå Load failed: ÿÆÿ∑ÿ£ ŸÅŸä ÿßŸÑÿßÿ™ÿµÿßŸÑ");
      }
    }
    // ===========================================================

    renderMenu();
  </script>
</body>
</html>
